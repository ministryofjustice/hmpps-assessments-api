CREATE TABLE IF NOT EXISTS external_source_question_mapping(
    external_source_question_mapping_id     SERIAL      PRIMARY KEY,
    external_source_question_mapping_uuid   UUID        NOT NULL UNIQUE,
    question_code                           VARCHAR(255) NOT NULL,
    assessment_schema_code                  VARCHAR(50) NOT NULL,
    external_source                         VARCHAR(50) NOT NULL,
    json_path_field                         VARCHAR(1024) NOT NULL,
    field_type                              VARCHAR(50),
    external_source_endpoint                VARCHAR(1024),
    mapped_value                            VARCHAR(50),
    if_empty                                BOOLEAN DEFAULT false,
    FOREIGN KEY (assessment_schema_code) REFERENCES assessment_schema (assessment_schema_code),
    FOREIGN KEY (question_code) REFERENCES question_schema (question_code)
);

INSERT INTO external_source_question_mapping (external_source_question_mapping_uuid, question_code, assessment_schema_code, external_source, json_path_field, field_type, external_source_endpoint, mapped_value, if_empty)
VALUES
('4e0dd4c4-d2c0-4701-93a8-65ed879aa575', 'family_name', 'ROSH', 'COURT', 'name.surname', 'varchar', null, null, false),
('e872d57c-e501-4fd4-ae70-7e9dba9551ce', 'first_name', 'ROSH', 'COURT', 'name.forename1', 'varchar', null, null, false),
('a93464c2-1828-46ea-ad5d-5d4e6accbe23', 'dob', 'ROSH', 'COURT', 'defendantDob', 'date', null, null, false),
('79cd9f1b-e06f-46ea-8125-8b29ec9c1e93', 'pnc', 'ROSH', 'COURT', 'pnc', 'varchar', null, null, false),
('b345f7bb-7398-4096-9802-c2599d762676', 'crn', 'ROSH', 'COURT', 'crn', 'varchar', null, null, false),
('a086610a-2135-40a4-ac88-da0534aee800', 'address_line_1', 'ROSH', 'COURT', 'defendantAddress.line1', 'varchar', null, null, false),
--UPW
('ba5d21bb-ee85-496b-9148-7062a925d384', 'first_name', 'UPW', 'DELIUS', 'firstName', 'varchar', 'secure/offenders/crn/$crn/all', null, false),
('e28fb88c-66ae-405e-9370-736e4225ff4a', 'first_name_aliases', 'UPW', 'DELIUS', '$.offenderAliases[*].[''firstName''])', 'array', 'secure/offenders/crn/$crn/all', null, false),
('e8e7e586-660f-40e8-a5cf-c78870efab41', 'family_name', 'UPW', 'DELIUS', 'surname', 'varchar', 'secure/offenders/crn/$crn/all', null, false),
('14796ba9-8f3a-48ee-b8b0-87f36b5c2e9e', 'family_name_aliases', 'UPW', 'DELIUS', '$.offenderAliases[*].[''surname''])', 'array', 'secure/offenders/crn/$crn/all', null, false),
('c8e38291-dbc1-432e-a248-94f2a8bd653a', 'dob', 'UPW', 'DELIUS', 'dateOfBirth', 'varchar', 'secure/offenders/crn/$crn/all', null, false),
('f9916f57-d398-43f1-a14d-9a5796d766d2', 'dob_aliases', 'UPW', 'DELIUS', '$.offenderAliases[*].[''dateOfBirth''])', 'array', 'secure/offenders/crn/$crn/all', null, false),
('5abb0441-57ee-4049-ad52-b4c5d34750dc', 'contact_address_building_name', 'UPW', 'DELIUS', '$.contactDetails.addresses[?(@.status.code==''M'')].buildingName', null, 'secure/offenders/crn/$crn/all', null, false),
('3da78bdf-b50e-4e1c-b762-8dc6231d9ec4', 'contact_address_house_number', 'UPW', 'DELIUS', '$.contactDetails.addresses[?(@.status.code==''M'')].addressNumber', null, 'secure/offenders/crn/$crn/all', null, false),
('7c97401a-51ef-4ea6-abf7-ab4afebba592', 'contact_address_street_name', 'UPW', 'DELIUS', '$.contactDetails.addresses[?(@.status.code==''M'')].streetName', null, 'secure/offenders/crn/$crn/all', null, false),
('48a72e06-7115-4ba3-978a-53350d0610af', 'contact_address_district', 'UPW', 'DELIUS', '$.contactDetails.addresses[?(@.status.code==''M'')].district', null, 'secure/offenders/crn/$crn/all', null, false),
('390135d2-9bc1-4b78-9f87-09a450c4cb48', 'contact_address_town_or_city', 'UPW', 'DELIUS', '$.contactDetails.addresses[?(@.status.code==''M'')].town', null, 'secure/offenders/crn/$crn/all', null, false),
('a0a3b08b-0084-44a4-b7df-380542337b83', 'contact_address_county', 'UPW', 'DELIUS', '$.contactDetails.addresses[?(@.status.code==''M'')].county', null, 'secure/offenders/crn/$crn/all', null, false),
('cc315d63-ddfa-4959-bb68-fd9a4be08a24', 'contact_address_postcode', 'UPW', 'DELIUS', '$.contactDetails.addresses[?(@.status.code==''M'')].postcode', null, 'secure/offenders/crn/$crn/all', null, false),
('7b21ad52-a2b5-4ef2-aa11-bebb4f7ac52a', 'crn', 'UPW', 'DELIUS', 'otherIds.crn', 'varchar', 'secure/offenders/crn/$crn/all', null, false),
('861bb639-61cf-4663-a2ef-55851135e8c5', 'pnc', 'UPW', 'DELIUS', 'otherIds.pncNumber', 'varchar', 'secure/offenders/crn/$crn/all', null, false),
('2ee48b0b-3677-4a97-ab77-27d99053ef61', 'ethnicity', 'UPW', 'DELIUS', 'offenderProfile.ethnicity', 'varchar', 'secure/offenders/crn/$crn/all', null, false),
('ebc6c624-eec2-48c8-86a2-6fe5bb52b84d', 'gender', 'UPW', 'DELIUS', '$[?(@.gender == ''Male'')].gender', 'mapped', 'secure/offenders/crn/$crn/all', 'MALE', false),
('d6055026-7423-46ec-ab11-4c5af8893d37', 'gender', 'UPW', 'DELIUS', '$[?(@.gender == ''Female'')].gender', 'mapped', 'secure/offenders/crn/$crn/all', 'FEMALE', false),
('8539dca3-6086-463d-b57b-2dfd2b17ab1c', 'gender_identity', 'UPW', 'DELIUS', '$[?(@.offenderProfile.genderIdentity == ''Male'')].offenderProfile.genderIdentity', 'mapped', 'secure/offenders/crn/$crn/all', 'MALE', false),
('5c657b13-3b31-4c68-8985-abdf3d8aa76b', 'gender_identity', 'UPW', 'DELIUS', '$[?(@.offenderProfile.genderIdentity == ''Female'')].offenderProfile.genderIdentity', 'mapped', 'secure/offenders/crn/$crn/all', 'FEMALE', false),
('4bd0fba6-e5c3-4974-bbf2-7cdd43922294', 'gender_identity', 'UPW', 'DELIUS', '$[?(@.offenderProfile.genderIdentity == ''Non-Binary'')].offenderProfile.genderIdentity', 'mapped', 'secure/offenders/crn/$crn/all', 'NON_BINARY', false),
('43b3783a-5d53-481d-9322-6674d510a061', 'gender_identity', 'UPW', 'DELIUS', '$[?(@.offenderProfile.genderIdentity == ''Prefer not to say'')].offenderProfile.genderIdentity', 'mapped', 'secure/offenders/crn/$crn/all', 'PREFER_NOT_TO_SAY', false),
('8dd8fd74-1a67-4b2f-b8da-26aa58424f20', 'gender_identity', 'UPW', 'DELIUS', '$[?(@.offenderProfile.genderIdentity == ''Prefer to self-describe'')].offenderProfile.genderIdentity', 'mapped', 'secure/offenders/crn/$crn/all', 'PREFER_TO_SELF_DESCRIBE', false),
('6638e173-9ab9-4078-a6cc-2af97ae7dbde', 'language', 'UPW', 'DELIUS', '$.offenderProfile.offenderLanguages.primaryLanguage', 'varchar', 'secure/offenders/crn/$crn/all', null, false),
('406e1725-2e8c-411e-972b-f8661f4ce539', 'requires_interpreter', 'UPW', 'DELIUS', '$.offenderProfile.offenderLanguages.requiresInterpreter', 'varchar', 'secure/offenders/crn/$crn/all', null, false),
('7a129e3a-fe40-4138-9832-643404982a2c', 'contact_email_addresses', 'UPW', 'DELIUS', '$.contactDetails.emailAddresses[*]', 'array', 'secure/offenders/crn/$crn/all', null, false),
('4eb108ac-bbb7-416b-8d05-64283bdc6df5', 'contact_mobile_phone_number', 'UPW', 'DELIUS', '$.contactDetails.phoneNumbers[?(@.type==''MOBILE'')].number', 'array', 'secure/offenders/crn/$crn/all', null, false),
('be7794a5-1025-4ee5-bf36-c49fa5cc2acf', 'contact_phone_number', 'UPW', 'DELIUS', '$.contactDetails.phoneNumbers[?(@.type==''TELEPHONE'')].number', 'array', 'secure/offenders/crn/$crn/all', null, false),


('080259f7-ef91-49af-8262-d7fc0240235b', 'autistic_disability', 'UPW', 'DELIUS', '$.offenderProfile.disabilities[?(@.disabilityType.code==''AS''&&@.isActive==true)]', 'structured', 'secure/offenders/crn/$crn/all', null, false),
('8e1dca63-0094-4515-a17e-5e552bedd637', 'dyslexia_disability', 'UPW', 'DELIUS', '$.offenderProfile.disabilities[?(@.disabilityType.code==''DY''&&@.isActive==true)]', 'structured', 'secure/offenders/crn/$crn/all', null, false),
('20ed6bb6-33cf-4b2d-83a0-99fa5211ebd8', 'visual_disability', 'UPW', 'DELIUS', '$.offenderProfile.disabilities[?(@.disabilityType.code==''VI''&&@.isActive==true)]', 'structured', 'secure/offenders/crn/$crn/all', null, false),
('51a0e59f-2d52-4c91-b90b-21640b5ba915', 'speech_disability', 'UPW', 'DELIUS', '$.offenderProfile.disabilities[?(@.disabilityType.code==''SI''&&@.isActive==true)]', 'structured', 'secure/offenders/crn/$crn/all', null, false),
('358b6c13-3ff5-4184-8865-fc6721936d25', 'hearing_disability', 'UPW', 'DELIUS', '$.offenderProfile.disabilities[?(@.disabilityType.code==''HD''&&@.isActive==true)]', 'structured', 'secure/offenders/crn/$crn/all', null, false),
('312d9d0e-2734-48ca-a4c4-e7e17a8cbb8b', 'learning_difficulties', 'UPW', 'DELIUS', '$.offenderProfile.disabilities[?(@.disabilityType.code==''LD''&&@.isActive==true)]', 'structured', 'secure/offenders/crn/$crn/all', null, false),
('6ec9aae0-0950-4701-99b0-1589584197b0', 'learning_disability', 'UPW', 'DELIUS', '$.offenderProfile.disabilities[?(@.disabilityType.code==''LA''&&@.isActive==true)]', 'structured', 'secure/offenders/crn/$crn/all', null, false),
('0f01a375-903d-4707-ade7-1d8c331afa9a', 'mental_disability', 'UPW', 'DELIUS', '$.offenderProfile.disabilities[?(@.disabilityType.code==''MI''&&@.isActive==true)]', 'structured', 'secure/offenders/crn/$crn/all', null, false),
('10fca145-2451-4d18-8006-5e402db32032', 'progressive_disability', 'UPW', 'DELIUS', '$.offenderProfile.disabilities[?(@.disabilityType.code==''PC''&&@.isActive==true)]', 'structured', 'secure/offenders/crn/$crn/all', null, false),
('4b3b2a12-4511-4a65-95b0-5506927da524', 'mobility_disability', 'UPW', 'DELIUS', '$.offenderProfile.disabilities[?(@.disabilityType.code==''RM''&&@.isActive==true)]', 'structured', 'secure/offenders/crn/$crn/all', null, false),
('7461b171-b4d8-438d-a491-2aee4ac8a27a', 'physical_disability', 'UPW', 'DELIUS', '$.offenderProfile.disabilities[?(@.disabilityType.code==''RC''&&@.isActive==true)]', 'structured', 'secure/offenders/crn/$crn/all', null, false),
('889dc81f-7985-49c3-b395-4ade2bcd0181', 'disfigurement_disability', 'UPW', 'DELIUS', '$.offenderProfile.disabilities[?(@.disabilityType.code==''SD''&&@.isActive==true)]', 'structured', 'secure/offenders/crn/$crn/all', null, false),
('5a6256f5-ed5b-4609-a208-6df04ff73e98', 'refuse_disability', 'UPW', 'DELIUS', '$.offenderProfile.disabilities[?(@.disabilityType.code==''RF''&&@.isActive==true)]', 'structured', 'secure/offenders/crn/$crn/all', null, false),
('7d1cb832-beee-4fd4-9f7e-309d630368eb', 'no_disability', 'UPW', 'DELIUS', '$.offenderProfile.disabilities[?(@.disabilityType.code==''OD''&&@.isActive==true)]', 'structured', 'secure/offenders/crn/$crn/all', null, false),


('8e219d36-6979-4018-8944-12777990910e', 'emergency_contact_details', 'UPW', 'DELIUS', '$[?(@.relationshipType.code==''ME''&&@.isActive==true)]', 'structured', 'secure/offenders/crn/$crn/personalContacts', null, false),
('cb24dc64-e8fd-4960-8096-1907d59de3b0', 'gp_details', 'UPW', 'DELIUS', '$[?(@.relationshipType.code==''RT02''&&@.isActive==true)]', 'structured', 'secure/offenders/crn/$crn/personalContacts', null, false),

('f4a45236-87c9-457b-b9a3-78db3384e870', 'allergies', 'UPW', 'DELIUS', '$.personalCircumstances[?(@.personalCircumstanceType.code==''D'' && @.personalCircumstanceSubType.code==''D03'')].personalCircumstanceSubType.description', 'yesno', 'secure/offenders/crn/$crn/personalCircumstances', null, false),
('e0004447-79e0-497c-85ff-303238555ab4', 'allergies_details', 'UPW', 'DELIUS', '$.personalCircumstances[?(@.personalCircumstanceType.code==''D'' && @.personalCircumstanceSubType.code==''D03'')].notes', null, 'secure/offenders/crn/$crn/personalCircumstances', null, false),
('581060dd-12d5-4f07-bca5-ef1526316dae', 'pregnancy', 'UPW', 'DELIUS', '$.personalCircumstances[?(@.personalCircumstanceType.code==''PM'' && @.personalCircumstanceSubType.code==''D06'')].personalCircumstanceSubType.description', 'mapped', 'secure/offenders/crn/$crn/personalCircumstances', 'PREGNANT', false),
('2bfe4909-4fa6-42aa-9c10-05c831368df4', 'pregnancy', 'UPW', 'DELIUS', '$.personalCircumstances[?(@.personalCircumstanceType.code==''PM'' && @.personalCircumstanceSubType.code==''D07'')].personalCircumstanceSubType.description', 'mapped', 'secure/offenders/crn/$crn/personalCircumstances', 'RECENTLY_GIVEN_BIRTH', false),
('84c150fc-2466-4f77-8ac7-245fb599fc11', 'pregnancy', 'UPW', 'DELIUS', '$.personalCircumstances[?(@.personalCircumstanceType.code==''PM'')]', 'mapped', 'secure/offenders/crn/$crn/personalCircumstances', 'NO', true),
('52bb75ca-4839-4276-b84e-618bbf171f98', 'pregnancy_pregnant_details', 'UPW', 'DELIUS', '$.personalCircumstances[?(@.personalCircumstanceType.code==''PM'' && @.personalCircumstanceSubType.code==''D06'')].notes', null, 'secure/offenders/crn/$crn/personalCircumstances', null, false),
('7ea11ea2-9d52-421e-8f71-8cf769026545', 'pregnancy_recently_given_birth_details', 'UPW', 'DELIUS', '$.personalCircumstances[?(@.personalCircumstanceType.code==''PM'' && @.personalCircumstanceSubType.code==''D07'')].notes', null, 'secure/offenders/crn/$crn/personalCircumstances', null, false),
('d48a7841-8398-4964-8fa9-30b932191296', 'caring_commitments', 'UPW', 'DELIUS', '$.personalCircumstances[?(@.personalCircumstanceType.code==''I'')].personalCircumstanceSubType.description', 'yesno', 'secure/offenders/crn/$crn/personalCircumstances', null, false),
('e2765bb6-5d2a-47c5-babb-d8cbd9842c26', 'caring_commitments_details', 'UPW', 'DELIUS', '$.personalCircumstances[?(@.personalCircumstanceType.code==''I'')].notes', null, 'secure/offenders/crn/$crn/personalCircumstances', null, false),
('cdd2f423-7805-4775-9ca2-ea23bf268365', 'reading_writing_difficulties', 'UPW', 'DELIUS', '$.personalCircumstances[?(@.personalCircumstanceType.code==''G'')].personalCircumstanceSubType.description', 'yesno', 'secure/offenders/crn/$crn/personalCircumstances', null, false),
('6a65d799-3796-497c-b09d-8dab9822fb6c', 'reading_writing_difficulties_details', 'UPW', 'DELIUS', '$.personalCircumstances[?(@.personalCircumstanceType.code==''G'')].notes', null, 'secure/offenders/crn/$crn/personalCircumstances', null, false)
;